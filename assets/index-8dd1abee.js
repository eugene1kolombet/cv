var is=Object.defineProperty;var ns=(h,s,t)=>s in h?is(h,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[s]=t;var a=(h,s,t)=>(ns(h,typeof s!="symbol"?s+"":s,t),t),me=(h,s,t)=>{if(!s.has(h))throw TypeError("Cannot "+t)};var c=(h,s,t)=>(me(h,s,"read from private field"),t?t.call(h):s.get(h)),C=(h,s,t)=>{if(s.has(h))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(h):s.set(h,t)},b=(h,s,t,e)=>(me(h,s,"write to private field"),e?e.call(h,t):s.set(h,t),t);import{A as St,s as P,S as os,a as x,T as as,B as f,b as et,C as rs,R as Be,c as N,G as R,d as T,f as hs,e as ls,y as cs,l as oe,g as ct,P as Yt,h as ds,i as us,u as ps,E as ms,j as gs,k as Lt,m as ys,n as fs}from"./vendor-2b80d49b.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const Oe="./assets/atlases/bitmap-font/bitmap-font.json",Ue="./assets/atlases/effects/effects.json",De="./assets/atlases/gems/gems.json",He="./assets/atlases/main/main.json",Ge="./assets/atlases/main_a/main_a.json",Ye="./assets/atlases/bg/bg.json",We="./assets/atlases/gui/gui.json",Ve="./assets/atlases/explosion/explosion.json",je="./assets/atlases/spark/spark.json",$e="./assets/atlases/circle_glow/circle_glow.json",ze="./assets/atlases/temp/temp.json",Xe="./assets/atlases/emoji/emoji.json",Ke="./assets/atlases/tower/tower.json",Ss=[Oe,Ue,De,He,Ge,Ye,We,Ve,je,$e,ze,Xe,Ke],v={},Wt={CHEST:"chest",TOWER_PLAYER:"tower_player",TOWER_ENEMY:"tower_enemy"},Ft={};class bs{async init(){for(const s of Ss)v[s]=await St.load(s);Ft[Wt.CHEST]=await St.load("./assets/atlases/chest/chestsprite.json"),Ft[Wt.TOWER_PLAYER]=await St.load("./assets/atlases/tower_player/knight.json"),Ft[Wt.TOWER_ENEMY]=await St.load("./assets/atlases/tower_enemy/skeleton.json"),P.add("boing","./assets/sounds/boing.mp3"),P.add("click1","./assets/sounds/click1.mp3")}getSpineAnimation(s){return new os(Ft[s].spineData)}getTextures(s){const t=[];for(let e=0;e<s.length;e++)t.push(this.getTexture(s[e]));return t}getTexture(s){let t;if(s.indexOf("font/")>=0)t=v[Oe];else if(s.indexOf("symbols/")>=0)t=v[Ue];else if(s.indexOf("gems/")>=0)t=v[De];else if(s.indexOf("gui/")>=0)t=v[We];else if(s.indexOf("bg/")>=0)t=v[Ye];else if(s.indexOf("explosion/")>=0)t=v[Ve];else if(s.indexOf("spark/")>=0)t=v[je];else if(s.indexOf("circle_glow/")>=0)t=v[$e];else if(s.indexOf("main/")>=0)t=v[He];else if(s.indexOf("main_a/")>=0)t=v[Ge];else if(s.indexOf("temp/")>=0)t=v[ze];else if(s.indexOf("emoji/")>=0)t=v[Xe];else if(s.indexOf("tower/")>=0)t=v[Ke];else throw new Error("missing type in path");if(!t)debugger;let e=t.textures[s];if(!e){const i=s.indexOf("/")>0?s.split("/")[1]:s;if(t!=null&&t.textures)e=t.textures[i];else throw new Error("atlas missing textures "+s);if(!e)throw new Error("problems with the texture: "+s)}return e}getSprite(s){return new x(this.getTexture(s))}getSpriteCentered(s){const t=this.getSprite(s);return t.anchor.set(.5,.5),t}}const y=new bs,Gt=document.querySelector("#pixi-container");Gt.clientWidth;Gt.clientHeight;const M=720,lt=1280,se=330,qe=720,z=10,X=1065;class ae{constructor(s){a(this,"_target");if(typeof s=="string")this._target=y.getSprite(s);else if(s instanceof as)this._target=new x(s);else if(s instanceof x)this._target=s;else if(s instanceof f)this._target=s;else if(s===void 0)this._target=new x;else throw"missing sprite "+s}get sp(){return this._target}get tf(){return this._target}get cnt(){return this._target}get instance(){return this._target}blending(s){return this._target instanceof f?(console.error("blending applied to bitmaptext"),this):(typeof s=="string"?this._target.blendMode=et[s]:this._target.blendMode=s,this)}call(s,...t){return s.apply(this._target,t),this}pos(s=0,t=0){return this._target.position.set(s,t),this}name(s){return this._target.name=s,this}anc(s,t){return this._target.anchor.set(s,t),this}roundPixels(s=!0){return this._target.roundPixels=s,this}alpha(s){return this._target.alpha=s,this}pivot(s=0,t=0){return this._target.pivot.set(s,t),this}scale(s=1,t=void 0){return t===void 0?(this._target.scale.set(s,s),this):(this._target.scale.set(s,t),this)}sc(s=1,t=void 0){return t===void 0?(this._target.scale.set(s,s),this):(this._target.scale.set(s,t),this)}x(s=0){return this._target.x=s,this}y(s=0){return this._target.y=s,this}w(s){return this._target.width=s,this}h(s){return this._target.height=s,this}size(s,t){return this._target.width=s,this._target.height=t??s,this}rot(s=0){return this._target.rotation=s,this}ang(s=0){return this._target.rotation=s/180*Math.PI,this}z(s){return this._target.zIndex=s,this}tint(s){return this._target.tint=s,this}show(){return this._target.visible=!0,this}hide(){return this._target.visible=!1,this}mask(s){let t=null;return s instanceof ae&&(t=s._target),this._target.mask=t,this}addAt(s,t){return s.addChildAt(this._target,t),this}addTo(s){if(!s||!this._target)throw new Error("missing target");return s.addChild(this._target),this}remove(){return this._target.parent.removeChild(this._target),this}interactive(s=!0){return this._target.interactive=s,this}buttonMode(s=!0){return this._target.cursor=s?"pointer":null,this}hitAreaCircle(s,t=0,e=0){return this._target.hitArea=new rs(t,e,s),this}hitAreaRectangle(s,t,e=0,i=0){return this._target.hitArea=new Be(e,i,s,t),this}}const p=(h=void 0)=>new ae(h);var F;class Cs{constructor(s,t,e,i){C(this,F,void 0);a(this,"scenesContainer");a(this,"currentSceneContainer");a(this,"currentCenteredContainer");a(this,"_clientWidth",0);a(this,"_clientHeight",0);a(this,"background");a(this,"activeZone");a(this,"activeZoneFrame");a(this,"updateScenePosition",!1);a(this,"mousePointer");a(this,"onMouseMove",s=>{const{x:t,y:e}=s;this.mousePointer.position.set(t,e)});a(this,"switchSceneTo",s=>{var e;(e=c(this,F))!=null&&e.gameScene&&(c(this,F).gameScene.teardown(),c(this,F).gameScene.cleanup()),this.currentSceneContainer&&this.scenesContainer.removeChild(this.currentSceneContainer),this.currentCenteredContainer&&this.scenesContainer.removeChild(this.currentCenteredContainer);const t=this.scenes.find(i=>i.name===s);if(t)this.setupScene(t);else throw new Error("SCENE NOT FOUND: "+s)});this.app=s,this.store=t,this.scenes=e;const n=this.scenes.find(r=>r.name===i);this.scenesContainer=new N,this.scenesContainer.name="SceneManager::scenesContainer",this.app.stage.addChild(this.scenesContainer),this.app.stage.name="app.stage",this.background=p("bg/background.png").addTo(this.scenesContainer).sp,this.activeZone=p("bg/active-zone.png").hide().addTo(this.scenesContainer).sp;const o=new R;if(o.name="activeZoneFrame",o.beginFill(16751989),o.alpha=.1,o.drawRect(0,0,M,qe),o.y=se,this.scenesContainer.addChild(o),this.activeZoneFrame=o,this.mousePointer=p("gui/arrow.png").scale(.5).addTo(this.app.stage).sp,s.renderer.view.onmousemove=this.onMouseMove,!n)throw new Error("startup scene not found: "+i);this.setupScene(n)}get scene(){return c(this,F)}get activeScene(){return c(this,F).gameScene}setupScene(s){b(this,F,s),this.currentSceneContainer=new N,this.scenesContainer.addChild(this.currentSceneContainer),this.currentCenteredContainer=new N,this.scenesContainer.addChild(this.currentCenteredContainer),s.gameScene||(s.gameScene=s.sceneFactory(),s.gameScene.name=c(this,F).name,console.log("activated scene "+s.name),s.gameScene.init(this.app,this.store,this.switchSceneTo,this)),s.gameScene.setSceneContainer(this.currentSceneContainer,this.currentCenteredContainer),s.gameScene.setup(),this.updateScenePosition=!localStorage.getItem("cachedPosition")}_updateScenePosition(s=!1){const{clientWidth:t,clientHeight:e}=Gt;if(s||this._clientWidth!=t||this._clientHeight!=e){console.log(`clientWidth ${t} clientHeight ${e}`);const i=e/lt;this.scenesContainer.scale.set(i,i);const n=t/2-M*i/2,o=e/2-lt*i/2;this.scenesContainer.position.set(n,o),this._clientWidth=t,this._clientHeight=e,this.scenesContainer.rotation=0}}update(s){var t;this.updateScenePosition&&this._updateScenePosition(),(t=c(this,F))!=null&&t.gameScene&&c(this,F).gameScene.updateScene(s)}}F=new WeakMap;const xs=[8781767,6105666,16745810,7830951,14991865],E=90,ws="https://res.cloudinary.com/anonra/image/upload/v1659301529/axe%20throwing/logo.png",Ts=5;var m=(h=>(h.MINI_TARGET_SCENE="mini_target_scene",h.TARGET_SCENE="target_scene",h.SURVIVAL_SCENE="survival_scene",h.MENU_SCENE="menu_scene",h.LUCKY_SCENE="lucky_scene",h.SCORE_SCENE="score_scene",h.MINESWEEPER_SCENE="minesweeper_scene",h.FLATTTENED_TARGET_SCENE="flattened_target_scene",h.TOWER_SCENE="tower_scene",h))(m||{});function dt(h,s){const t=new R;t.x=30,t.y=25,t.interactive=!0,s&&s.addChild(t);const e=164,i=51,n=()=>{t.clear(),t.beginFill(12632256),t.drawRect(0,0,e,i)},o=()=>{t.clear(),t.beginFill(0),t.drawRect(0,0,e,i)};o();const r=new f("MENU",{fontName:"Inter",fontSize:32});return r.x=t.width/2-r.width/2,r.y=t.height/2-r.height/2,t.addChild(r),t.on("mousedown",h,this),t.on("touchstart",h,this),t.on("mouseover",n,this),t.on("mouseout",o,this),t}function ut(h){p("gui/throw_player.png").pos(530,25).addTo(h).sp}function Es(h){const s=new R;s.x=0;const t=50;s.beginFill(xs[2]),s.drawRect(0,0,t,t),s.interactive=!0,s.on("mousedown",h,this),s.on("touchstart",h,this);const e=new f("ADD",{fontName:"sans-serif",fontSize:20});return e.x=s.width/2-e.width/2,e.y=s.height/2-e.height/2,s.addChild(e),s}function pt(h){const e=p("emoji/click_if_missed_btn.png").anc(0,0).sp;e.x=530,e.y=268,e.interactive=!0;const i=()=>{o.clear(),o.beginFill(0,.2),o.drawRect(0,0,163-4,70+16)},n=()=>{o.clear(),o.beginFill(12632256,0),o.drawRect(0,0,163-4,70+16)},o=new R;e.addChild(o),n();const r=()=>{P.play("boing"),h()};e.on("mouseup",r,this),e.on("touchend",r,this),e.on("mouseover",i,this),e.on("mouseout",n,this);const l=new f("I MISSED",{fontName:"Inter",fontSize:26});return l.x=12,l.y=30,o.addChild(l),e}function vs(h,s){const t=p("temp/continue_btn.png").anc(0,0).sp,e=t.width,i=t.height;t.interactive=!0;const n=()=>{r.clear(),r.beginFill(0,.2),r.drawRect(0,0,e-4,i+16)},o=()=>{r.clear(),r.beginFill(12632256,0),r.drawRect(0,0,e-4,i+16)},r=new R;t.addChild(r),o();const l=()=>{h.call(s)};return t.on("mouseup",l,this),t.on("touchend",l,this),t.on("mouseover",n,this),t.on("mouseout",o,this),t}class K{constructor(){a(this,"app");a(this,"switchSceneTo");a(this,"_sceneContainer");a(this,"centered");a(this,"tickTime",0);a(this,"stage");a(this,"store");a(this,"sceneManager")}get sceneContainer(){return this._sceneContainer}init(s,t,e,i){this.app=s,this.store=t,this.stage=s.stage,this.switchSceneTo=e,this.sceneManager=i}setSceneContainer(s,t){this._sceneContainer=s,this._sceneContainer.name="AbstractGameScene::_sceneContainer",this.centered=t,this.centered.position.set(M/2,lt/2),this.centered.name="AbstractGameScene::centered"}cleanup(){for(this.centered&&(this._sceneContainer.removeChild(this.centered),this.centered=null);this._sceneContainer.children.length>0;)this._sceneContainer.removeChildAt(0)}update(s){}updateScene(s){this.tickTime-=s,this.tickTime<=0&&(this.tickTime+=Ts,this.tick()),this.update(s)}}const re="ADD_PLAYER",Ze="SELECT_PLAYER",he="PLAYER_SCORE",le="PLAYER_MISS",ce="PLAYERS_RESET",de="SCORE_RESET",Je="CHOOSE_GAME";function ue(){return{type:re}}function j(h,s,t){return{type:he,payload:{player:h,score:s,game:t}}}function Qe(h){return{type:Ze,payload:{player:h}}}function O(h=void 0,s){return{type:le,payload:{player:h,game:s}}}function ts(){return{type:ce}}function st(){return{type:de}}function ie(h){return{type:Je,payload:{game:h}}}const Nt=100,Rt=90;var Et,Y,vt,J,Q;class ge extends N{constructor(){super();a(this,"activeBg");a(this,"background");a(this,"scoreText");a(this,"missText");a(this,"playerName");C(this,Et,void 0);C(this,Y,void 0);C(this,vt,void 0);C(this,J,void 0);C(this,Q,void 0);const t=new R;t.beginFill(16751989),t.drawRect(0,0,Nt,Rt),b(this,J,new x(y.getTexture("emoji/not_selected_player_bg.png"))),this.addChild(c(this,J)),c(this,J).visible=!1,b(this,Q,new x(y.getTexture("emoji/selected_player_bg.png"))),this.addChild(c(this,Q)),c(this,Q).visible=!1;const e=new R;e.beginFill(15610624),e.drawRect(0,0,Nt,Rt),this.addChild(e);const i=new f("",{fontName:"Arial",fontSize:18,align:"center"});i.position.set(5,2),this.addChild(i);const n=new f("0",{fontName:"Inter",fontSize:33,align:"center"});n.position.set(10,3),this.addChild(n);const o=new f("0",{fontName:"Inter",fontSize:33,align:"center"});o.position.set(10,60),this.addChild(o),b(this,vt,p("emoji/1.png").pos(45,40-2).scale(55/36,55/36).addTo(this).sp),b(this,Y,p("gui/frame.png").pos(Nt/2,Rt/2).size(Nt,Rt).anc(.5,.5).addTo(this).sp);const r={from:null,to:null};r.from=c(this,Y).scale.clone(),r.to=c(this,Y).scale.clone();const l=1.1;r.to.x*=l,r.to.y*=l;const d=1e3;new T.Tween(c(this,Y).scale).repeat(1/0).to({x:r.to.x,y:r.to.y},d).easing(T.Easing.Quadratic.Out).start(),new T.Tween(c(this,Y)).repeat(1/0).to({alpha:0},d).easing(T.Easing.Quadratic.Out).start(),this.scoreText=n,this.missText=o,this.playerName=i,this.activeBg=e,this.interactive=!0}get frame(){return c(this,Y)}set id(t){b(this,Et,t),c(this,vt).texture=y.getTexture("emoji/"+(t+1)+".png")}get id(){return c(this,Et)}SetCurrent(){this.frame.visible=!1,this.activeBg.visible=!1,c(this,Q).visible=!0,c(this,J).visible=!1}SetNotCurrent(){this.frame.visible=!1,this.activeBg.visible=!1,c(this,Q).visible=!1,c(this,J).visible=!0}SetScoreVisible(t){this.scoreText.visible=t,this.missText.visible=!1}}Et=new WeakMap,Y=new WeakMap,vt=new WeakMap,J=new WeakMap,Q=new WeakMap;class ye{constructor(){a(this,"_callbacks",[]);a(this,"dispatch",s=>{for(let t=0;t<this._callbacks.length;t++)this._callbacks[t](s)});this.dispatch.bind(this)}add(s){this._callbacks.push(s)}unsubscribe(s){const t=this._callbacks.indexOf(s);t<0||this._callbacks.splice(t,1)}}async function _s(h,s,t){const e={"content-type":"application/json",...t},i=await hs(h,{method:"POST",headers:e,body:ls.json(s),responseType:cs.Text});if(!i.ok){const n=`An error has occured: ${i.status}`;throw new Error(n)}}let Vt=null;function Tt(){return Vt||(Vt=new Ls),Vt}function As(){const h=new Date,s=h.getFullYear(),t=String(h.getMonth()+1).padStart(2,"0"),e=String(h.getDate()).padStart(2,"0"),i=String(h.getHours()).padStart(2,"0"),n=String(h.getMinutes()).padStart(2,"0");return`${s}.${t}.${e}.${i}:${n}`}function Ps(h={}){return h["user-agent"]="Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405",h}const fe="2cd76726-7d3b-40f3-8089-56847945bbe7",Ms="f39b8376-2d0c-4177-85df-758a1be712c7";class Ls{constructor(){a(this,"apiEndpoint");a(this,"website");a(this,"machineId");a(this,"isEnabled",!1);a(this,"players");this.apiEndpoint="https://analytics.umami.is/api/send",this.website=fe,this.players=1}setHwId(s){return this.machineId=s,this.isEnabled=!0,this}setIsDevelopersBuild(s){return this.website=s?fe:Ms,this}setPlayersAmount(s){return this.players=s,this}async send(s){if(!this.isEnabled)return this;try{const e=JSON.parse('{"type":"event","payload":{"data":{},"website":""}}');e.payload.website=this.website,e.payload.name=this.machineId;const i=As();e.payload.data.gameStart="time "+i+" game:"+s+" players:"+this.players,_s(this.apiEndpoint,e,Ps())}catch{}return this}}class it extends x{constructor(t,e){super();a(this,"players",[]);a(this,"activePlayer");a(this,"addPlayerBtn");a(this,"store");a(this,"activePlayerLabel");a(this,"gameType");a(this,"onRound",new ye);a(this,"onScoreTable",new ye);a(this,"roundIndex",0);a(this,"TopBigPlayer");a(this,"onClickHandler",t=>{const e=t.target;console.log("player click "+e.id),this.store.dispatch(Qe(e.id))});a(this,"createPlayer",(t,e,i)=>{const n=new ge;n.position.set(t,e),n.id=i,n.on("click",this.onClickHandler,this),this.addChild(n),this.players.push(n)});if(!e)throw new Error("game type should be provided");if(this.store=t,this.gameType=e,this.activePlayerLabel=new f("[Player Id]",{fontName:"Desyrel",fontSize:30}),this.activePlayerLabel.filters=[new oe({color:0,innerStrength:0,outerStrength:1})],p(this.activePlayerLabel).x(10).y(-43).addTo(this),this.activePlayerLabel.visible=!1,this.players.length===0){let n=0;for(let o=0;o<6;o++)this.createPlayer(10+115*o,0,n),n++;for(let o=0;o<6;o++)this.createPlayer(10+115*o,113+8-10,n),n++}else for(const i of this.players)this.addChild(i);this.addPlayerBtn=Es(()=>t.dispatch(ue())),this.addChild(this.addPlayerBtn)}updateState(t){let e=!1;Tt().setPlayersAmount(t.players.length);const i=this.gameType!==m.MENU_SCENE;for(let n=0;n<this.players.length;n++){const o=t.players[n],r=!!o;if(this.players[n].visible=r,!e&&!r){e=!0;const{x:l,y:d}=this.players[n].position;this.addPlayerBtn.position.set(l,d+30)}if(this.players[n].SetScoreVisible(i),o&&i){if(!o[this.gameType])throw new Error("game type should be provided");const{score:l,miss:d}=o[this.gameType];this.players[n].scoreText.text=l+"",this.players[n].missText.text=d+""}}this.addPlayerBtn.visible=e,this.gameType!=="menu_scene"&&(this.onRound.dispatch(this.roundIndex),t.players.filter(o=>o[this.gameType]&&o[this.gameType].score>=100).length>0&&this.onScoreTable.dispatch(this.roundIndex)),this.activePlayer=t.activePlayer.activePlayer,this.activePlayerLabel.text=`THROW PLAYER ${this.activePlayer+1}`;for(let n=0;n<this.players.length;n++)if(n==this.activePlayer){if(this.players[n].SetCurrent(),i&&(this.recreateTopBigPlayer(n),t.players.length)){const o=t.players[n],{score:r,miss:l}=o[this.gameType];this.TopBigPlayer.scoreText.text=r+"",this.TopBigPlayer.missText.text=l+""}}else this.players[n].SetNotCurrent()}recreateTopBigPlayer(t){this.TopBigPlayer!=null&&this.removeChild(this.TopBigPlayer),this.TopBigPlayer=new ge,this.TopBigPlayer.position.set(-z+530-3,-X+112),this.TopBigPlayer.id=t,this.TopBigPlayer.scale.set(1.47,1.47),this.TopBigPlayer.SetNotCurrent(),this.addChild(this.TopBigPlayer)}}let pe=null,es=null;async function Fs(){pe=await St.load(ws),es=await St.load("assets/textures/chest_level_clear.png")}function nt(h=!0){const s=this;h&&p(s).size(265,265).anc(.5,.5).pos(M/2,163),s.texture=pe}function Ns(h,s=!0){s&&p(h).size(265,265).anc(.5,.5).pos(M/2,163),h.texture=pe}function Rs(h){h.texture=es}const Ht=m.MINI_TARGET_SCENE,ks=[{startRingIndex:0,position:{x:-130,y:170},scores:[13,9,6,3,1],targetIndices:[1,2,3,4,5],textFields:[{position:{x:0,y:-170}},{position:{x:0,y:-130}},{position:{x:0,y:-90}},{position:{x:0,y:-50}},{position:{x:0,y:0}}]},{startRingIndex:0,position:{x:150,y:-100},scores:[21,0,9,0,1],targetIndices:[1,2,3,4,5],textFields:[{position:{x:0,y:-170}},{position:{x:0,y:-130}},{position:{x:0,y:-90}},{position:{x:0,y:-50}},{position:{x:0,y:0}}]},{startRingIndex:2,position:{x:-160,y:-140},scores:[16,4,2,0,1],targetIndices:[1,2,3,4,5],textFields:[{position:{x:0,y:-170}},{position:{x:0,y:-130}},{position:{x:0,y:-90}},{position:{x:0,y:-50}},{position:{x:0,y:0}}]},{startRingIndex:2,position:{x:180,y:210},scores:[18,2,1,0,1],targetIndices:[1,2,3,4,5],textFields:[{position:{x:0,y:-170}},{position:{x:0,y:-130}},{position:{x:0,y:-90}},{position:{x:0,y:-50}},{position:{x:0,y:0}}]}];var _t;class Is extends x{constructor(t,e){super();C(this,_t,void 0);a(this,"isActive",!1);b(this,_t,e),this.texture=y.getTexture(t),this.anchor.set(.5,.5)}get targetIndex(){return c(this,_t)}}_t=new WeakMap;let Bs=class extends x{constructor(t,e,i,n){super();a(this,"store");a(this,"target");a(this,"explosion");a(this,"app");a(this,"activeTarget");a(this,"radiuses");a(this,"targets");a(this,"labels");a(this,"config");this.app=e,this.store=t,this.explosion=i,this.config=n;const{targetIndices:o,textFields:r}=n;this.radiuses=[],this.targets=[],this.labels=[],this.target=p().addTo(this).y(0).sp;for(let l=n.startRingIndex;l<o.length;l++){const d=o[l],g="ellipse_"+d,u=new Is("main/"+g+".png",d);u.interactive=!0,u.scale.set(.7,.7),this.targets.push(u),this.target.addChild(u),this.radiuses.push(u.width/2);const w=r[l],L=n.scores[n.scores.length-l-1].toString();let ot;l!==1?ot=new f(L,{fontName:"Arial",fontSize:40,align:"center"}):ot=new f(L,{fontName:"Desyrel",fontSize:40,align:"center"}),ot.position.set(w.position.y-ot.width/2,w.position.x-ot.height/2),this.target.addChild(ot),this.labels.push(ot)}this.radiuses.push(0),this.radiuses=this.radiuses.reverse(),this.targets=this.targets.reverse()}onMouseMove(t){const{x:e,y:i}=this.toLocal(t.data.global),n=Math.sqrt(e*e+i*i);let o=-1;for(let r=0;r<this.radiuses.length;r++)if(this.radiuses[r]<n&&this.radiuses[r+1]>n){if(isNaN(r))throw new Error("index is not a number");o=r;break}for(let r=0;r<this.targets.length;r++){const l=this.targets[r],d=r===o;if(l.isActive!==d){let g=null;d?(P.play("click1"),g="hover_ellipse_"+l.targetIndex):g="ellipse_"+l.targetIndex;const u="main/"+g+".png";l.texture=y.getTexture(u)}l.isActive=d}o!==this.activeTarget&&(this.activeTarget=o)}onMouseUp(t){const{x:e,y:i}=t.data.global,n=this.store.getState(),{activePlayer:o}=n.activePlayer;this.explosion(e,i),P.play("boing"),this.activeTarget>=0?this.store.dispatch(j(o,this.config.scores[this.activeTarget],Ht)):this.store.dispatch(O(o,Ht))}subscribe(){this.interactive=!0,this.target.interactive=!0,this.on("mousemove",this.onMouseMove,this),this.on("mouseup",this.onMouseUp,this)}unsubscribe(){this.interactive=!1,this.removeAllListeners()}};class Os extends K{constructor(){super(...arguments);a(this,"playersPanel");a(this,"activeTarget");a(this,"playersList");a(this,"explosionAnimation");a(this,"riskyTarget");a(this,"storeUnsub");a(this,"menuItemBtn");a(this,"missMenuBtn");a(this,"targets",[])}setup(){const t=()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())};this.menuItemBtn=dt(t),this._sceneContainer.addChild(this.menuItemBtn),ut(this._sceneContainer),this.missMenuBtn=pt(()=>{const e=this.store.getState(),{activePlayer:i}=e.activePlayer;this.store.dispatch(O(i,Ht))}),this.missMenuBtn.interactive=!0,this._sceneContainer.addChild(this.missMenuBtn);for(const e of ks){const i=new Bs(this.store,this.app,this.explosion.bind(this),e),{x:n,y:o}=e.position;i.position.set(n,o),this.centered.addChild(i),this.targets.push(i)}this.playersList=new it(this.store,Ht),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),p(this.playersList).pos(z,X).addTo(this._sceneContainer),p().addTo(this._sceneContainer).call(nt),this.storeUnsub=this.store.subscribe(this.updateState.bind(this)),this.updateState(),setTimeout(this.subscribe.bind(this),500),this.addExplosionAnimation()}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.app.stage).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}subscribe(){for(const t of this.targets)t.subscribe()}unsubscribe(){for(const t of this.targets)t.unsubscribe()}updateState(){const t=this.store.getState();this.playersList.updateState(t)}teardown(){this.app.stage.removeChild(this.explosionAnimation),this.storeUnsub(),this.unsubscribe()}tick(){}}const Ct=m.TARGET_SCENE,Us=[13,9,6,3,1],Ds=[1,2,3,4,5],Hs=[{text:"13",position:{x:0,y:0}},{text:"9",position:{x:0,y:-70}},{text:"6",position:{x:0,y:-130}},{text:"3",position:{x:0,y:-185}},{text:"1",position:{x:0,y:-245}}];let q,mt,kt,Se,be,jt,It,Ce=class extends x{constructor(t){super();a(this,"targetIndex");a(this,"isViolet");a(this,"isActive");this.anchor.set(.5,.5),this.texture=y.getTexture(t)}};class Gs extends K{constructor(){super(...arguments);a(this,"playersPanel");a(this,"activeTarget");a(this,"playersList");a(this,"target");a(this,"explosionAnimation")}setup(){be=dt(()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())}),this._sceneContainer.addChild(be),ut(this._sceneContainer),jt=pt(()=>{const i=this.store.getState(),{activePlayer:n}=i.activePlayer;this.store.dispatch(O(n,Ct))}),jt.interactive=!0,this._sceneContainer.addChild(jt),q=[],mt=[],kt=[],It=0,this.target=p().addTo(this.centered).y(0).sp;for(const i of Ds){const n="ellipse_"+i,o=new Ce("main/"+n+".png");o.targetIndex=i,o.interactive=!0,mt.push(o),this.target.addChild(o),q.push(o.width/2)}q.push(0);const e=40;for(const i of Hs){const n=new f(i.text,{fontName:"Arial",fontSize:e,align:"center"});n.position.set(i.position.y-n.width/2,i.position.x-n.height/2),this.target.addChild(n)}this.addVioletTarget(-180,-170),this.addVioletTarget(180,-170),q=q.reverse(),mt=mt.reverse(),this.playersList=new it(this.store,Ct),this.playersList.y=X,this.playersList.x=z,p(this.playersList).addTo(this._sceneContainer),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),p().call(nt).addTo(this._sceneContainer),Se=this.store.subscribe(this.updateState.bind(this)),this.updateState(),setTimeout(this.subscribe.bind(this),500),this.addExplosionAnimation()}addVioletTarget(t,e){const i="violet_circle.png",n=new Ce("main/"+i);n.isViolet=!0,n.scale.set(.17,.17),n.position.set(t,e),n.interactive=!0,n.visible=!1,this.target.addChild(n);const o=new f("20",{fontName:"Desyrel",align:"center"});o.visible=!1,o.filters=[new oe({color:0,innerStrength:0,outerStrength:1})],o.position.set(n.position.x-o.width/2,n.position.y-o.height/2),this.target.addChild(o),n.on("mouseup",this.onVioletClick,this),kt.push(n),kt.push(o)}onVioletClick(){const t=this.store.getState(),{activePlayer:e}=t.activePlayer;P.play("boing"),this.store.dispatch(j(e,20,Ct))}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.app.stage).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}subscribe(){this.centered.interactive=!0,this.centered.on("mousemove",this.onMouseMove,this),this.centered.on("mouseup",this.onMouseUp,this)}unsubscribe(){this.centered.interactive=!1,this.centered.removeAllListeners()}updateState(){const t=this.store.getState();this.playersList.updateState(t)}onMouseUp(t){const{x:e,y:i}=t.data.global,n=this.store.getState(),{activePlayer:o}=n.activePlayer;if(this.explosion(e,i),P.play("boing"),this.activeTarget>=0?this.store.dispatch(j(o,Us[this.activeTarget],Ct)):this.store.dispatch(O(o,Ct)),It++,It>10&&It<12)for(const r of kt)r.visible=!0,r.interactive=!0,r.on("mouseup",this.onVioletClick,this)}onMouseMove(t){const{x:e,y:i}=this.centered.toLocal(t.data.global),n=Math.sqrt(e*e+i*i);let o=-1;for(let r=0;r<q.length;r++)if(q[r]<n&&q[r+1]>n){o=r;break}for(let r=0;r<mt.length;r++){const l=mt[r],d=r===o;if(l.isActive!==d){const g=l.targetIndex;if(d){P.play("click1");const u="hover_ellipse_"+g;l.texture=y.getTexture("main/"+u+".png")}else{const u="ellipse_"+g;l.texture=y.getTexture("main/"+u+".png")}}l.isActive=d}this.activeTarget=o}teardown(){this.app.stage.removeChild(this.explosionAnimation),Se(),this.unsubscribe()}tick(){}}function A(h){if(!h){debugger;throw new Error("Assert happen ")}}class Ys{constructor(s,t){a(this,"x");a(this,"f");a(this,"n");this.x=s,this.f=t,this.n=this.x.length}lastX(){return this.x[this.n-1]}F(s){let t;if(A(this.x.length>0&&this.f.length>0&&this.x.length==this.f.length),s<this.x[0])return this.f[0];if(s>this.x[this.n-1])return this.f[this.n-1];if(s==this.x[this.n-1])return this.f[this.n-1];let e=-1;for(let i=0;i<this.n-1;i++)if(s>this.x[i]&&s<=this.x[i+1]){e=i;break}if(s==this.x[0]&&(e=0),e==-1)return this.f[this.n-1];if(this.n>1){const i=(s-this.x[e])/(this.x[e+1]-this.x[e]);t=this.f[e]+(this.f[e+1]-this.f[e])*i}else t=this.f[e];return t}area(s){let t=0;for(let e=0;e<this.n-1;e++){if(s==this.x[e])return t;if(s>this.x[e]&&s<=this.x[e+1])return t+=(s-this.x[e])*(this.f[e]+this.F(s))*.5,t;t+=(this.x[e+1]-this.x[e])*(this.f[e]+this.f[e+1])*.5}return t}normalize(s){const t=this.area(this.lastX());if(t==0)return;const e=s/t;for(let i=0;i<this.n;i++)this.f[i]*=e}}function V(h,s){return h=Math.ceil(h),s=Math.floor(s),Math.floor(Math.random()*(s-h+1)+h)}const $t=m.TOWER_SCENE;function gt(h){return y.getTexture(h)}let xe,zt;class Ws{constructor(){a(this,"animEnemy");a(this,"numHP",10);a(this,"enemyRect");a(this,"bitmapTextHP");a(this,"dead",!1)}}class Vs{constructor(){a(this,"enemysOnFloor",[])}}class we{constructor(){a(this,"floor");a(this,"enemyId");a(this,"rect",new Be)}}class js extends K{constructor(){super(...arguments);a(this,"numberFloors",20);a(this,"numberAddFloors",1);a(this,"sprSky");a(this,"sprFarMountains");a(this,"sprMountains");a(this,"sprFloors",[]);a(this,"sprFloorNumbers",[]);a(this,"animPlayer");a(this,"playerScale",.3);a(this,"playerWalkSpeed",90);a(this,"enemys",[]);a(this,"playersList");a(this,"explosionAnimation");a(this,"towerContainer");a(this,"downBound",1056);a(this,"FarMountainsInitPos",45);a(this,"MountainsInitPos",295);a(this,"floors",[]);a(this,"YShiftBase");a(this,"YShift");a(this,"VFromT");a(this,"moving");a(this,"curMovingTime",0);a(this,"beforeFrameTime");a(this,"firstFloorShift",270);a(this,"othersFloorShift",186);a(this,"firstFloorHeight",270);a(this,"currentFloor");a(this,"playerFloor");a(this,"cloudsScrollK",.1);a(this,"farMountainsScrollK",.2);a(this,"mountainsScrollK",.4);a(this,"PlayerBaseY",932);a(this,"enemyX",[170,250,470,550]);a(this,"enemyWidth",60);a(this,"enemyHeight",90);a(this,"enemyPivotShifUp",88);a(this,"enemyPivotShifLeft",30);a(this,"targetEnemy");a(this,"grHitRects",[]);a(this,"playerStates",[]);a(this,"playerStatesDrawed",[]);a(this,"playerWalkTargetX",0);a(this,"player2enemyDistX",40);a(this,"playerLadderPosX",355);a(this,"bitmapHPUpSHift",125);a(this,"NumFloorsForRect",3);a(this,"floorNumberBase",850);a(this,"floorNumbers",[]);a(this,"playerTimeout1");a(this,"playerTimeout2");a(this,"timeout");a(this,"playerWalkAnimModifyer",1.5)}setup(){this.YShiftBase=0,this.YShift=0,this.moving=!1,this.beforeFrameTime=-1e3,this.currentFloor=0,this.playerFloor=0,this.towerContainer=new N,this.towerContainer.name="towerContainer",this._sceneContainer.addChild(this.towerContainer);const t=new Yt(0,0),e=new Yt(M,1050),i=this.towerContainer.toGlobal(t),n=i.x,o=i.y,r=this.towerContainer.toGlobal(e),l=r.x-n,d=r.y-o;this.towerContainer.mask=new R().beginFill(16777215).drawRect(n,o,l,d).endFill(),this.sprSky=new x(gt("tower/bg1.png")),this.sprSky.name="towerSky",this.towerContainer.addChild(this.sprSky),this.sprFarMountains=new x(gt("tower/bg2.png")),this.sprFarMountains.name="farMountains",this.sprFarMountains.y=this.FarMountainsInitPos,this.towerContainer.addChild(this.sprFarMountains),this.sprMountains=new x(gt("tower/bg3.png")),this.sprMountains.name="mountains",this.sprMountains.y=this.MountainsInitPos,this.towerContainer.addChild(this.sprMountains);let g=new x(gt("tower/floor_zero.png"));g.name="floor_zero",this.floors.push(this.downBound-this.firstFloorHeight),g.position.y=this.floors[0],this.towerContainer.addChild(g),this.sprFloors.push(g);for(let w=1;w<this.numberFloors+this.numberAddFloors;w++)w<this.numberFloors?(g=new x(gt("tower/floor.png")),g.name=`floor_${w}`,this.floors.push(this.downBound-this.firstFloorHeight-w*this.othersFloorShift)):(g=new x(gt("tower/floor_top.png")),g.name="floor_top",this.floors.push(this.downBound-this.firstFloorHeight-w*this.othersFloorShift+102),g.position.x=77),g.position.y=this.floors[w],this.towerContainer.addChild(g),this.sprFloors.push(g);for(let w=0;w<this.numberFloors+this.numberAddFloors;w++){const L=new f((w+1).toString(),{fontName:"Inter",fontSize:20});L.name=`floorNumber_${w+1}`,L.tint=43520,L.x=100,L.y=this.floorNumberBase-w*this.othersFloorShift,this.floorNumbers.push(L.y),this.sprFloorNumbers.push(L),this.towerContainer.addChild(L)}this.createPlayer(),this.createEnemys(),dt(()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())},this._sceneContainer),zt=pt(()=>{const w=this.store.getState(),{activePlayer:L}=w.activePlayer;this.store.dispatch(O(L,$t))}),zt.interactive=!0,this._sceneContainer.addChild(zt),ut(this._sceneContainer),this.playersList=new it(this.store,$t),this.playersList.y=X,this.playersList.x=z,p(this.playersList).addTo(this._sceneContainer),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),p().call(nt).addTo(this._sceneContainer),xe=this.store.subscribe(this.updateState.bind(this)),this.updateState(),this.timeout=setTimeout(this.subscribe.bind(this),500),this.addExplosionAnimation(),this.drawHitRects()}teardown(){this.app.stage.removeChild(this.explosionAnimation),xe(),this.unsubscribe(),this.enemys=[],this.VFromT=null,this.playerStates=[],this.playerStatesDrawed=[],this.sprFloors=[],this.floors=[],this.sprFloorNumbers=[],this.floorNumbers=[],T.removeAll(),clearTimeout(this.playerTimeout1),clearTimeout(this.playerTimeout2),clearTimeout(this.timeout)}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.app.stage).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}subscribe(){this.towerContainer.interactive=!0,this.towerContainer.on("mouseup",this.onMouseUp,this),this.towerContainer.on("touchend",this.onMouseUp,this)}unsubscribe(){this.towerContainer.interactive=!1,this.towerContainer.removeAllListeners()}updateState(){const t=this.store.getState();this.playersList.updateState(t)}onMouseUp(t){if(this.playerStates.length)return;let{x:e,y:i}=t.data.global;this.explosion(e,i);const n=this.towerContainer.toLocal(new Yt(e,i));e=n.x,i=n.y;const o=this.getEnemyRects();for(let r=0;r<o.length;r++)if(o[r].rect.contains(e,i)){if(console.log("target appear"),this.targetEnemy=o[r],o[r].floor==this.playerFloor&&this.playerStates.push(10),o[r].floor>this.playerFloor){this.playerStates.push(11);const l=o[r].floor-this.playerFloor;if(l==1)this.playerStates.push(0);else if(l==2)this.playerStates.push(1),this.playerStates.push(3);else{this.playerStates.push(1);for(let d=0;d<l-2;d++)this.playerStates.push(2);this.playerStates.push(3)}this.playerStates.push(10)}if(o[r].floor<this.playerFloor){this.playerStates.push(11);const l=this.playerFloor-o[r].floor;if(l==1)this.playerStates.push(4);else if(l==2)this.playerStates.push(5),this.playerStates.push(7);else{this.playerStates.push(5);for(let d=0;d<l-2;d++)this.playerStates.push(6);this.playerStates.push(7)}this.playerStates.push(10)}this.startNextPlayerState();break}}tick(){}startNextPlayerState(){if(!this.playerStates.length){this.drawHitRects();return}switch(this.playerStates[0]){case 0:case 1:case 2:case 3:this.climbLadderUp();break;case 4:case 5:case 6:case 7:this.climbLadderDown();break;case 8:this.onWantCameraUp();break;case 10:this.walk2Monster();break;case 11:this.walk2Ladder();break;default:A(!1)}}onWantCameraUp(){if(this.moving){console.log("onWantCameraUp moving");return}A(this.VFromT==null),this.VFromT=new Ys([0,.5,2,2.5],[0,200,200,0]),this.currentFloor?this.VFromT.normalize(this.othersFloorShift):this.VFromT.normalize(this.firstFloorShift),this.moving=!0,this.curMovingTime=0,this.drawHitRects(),this.animPlayer.state.setAnimation(0,"idle",!0)}onWantCameraReset(){this.playerStates.length||(this.YShift=0,this.YShiftBase=0,this.currentFloor=0,this.updateCoords(),this.animPlayer.y=this.PlayerBaseY,this.drawHitRects())}updateCoords(){this.sprFarMountains.y=this.FarMountainsInitPos+(this.YShiftBase+this.YShift)*this.farMountainsScrollK,this.sprMountains.y=this.MountainsInitPos+(this.YShiftBase+this.YShift)*this.mountainsScrollK;for(let e=0;e<this.sprFloors.length;e++)this.sprFloors[e].y=this.floors[e]+this.YShiftBase+this.YShift,this.sprFloorNumbers[e].y=this.floorNumbers[e]+this.YShiftBase+this.YShift;this.animPlayer.y=this.PlayerBaseY-this.othersFloorShift*this.playerFloor+this.YShiftBase+this.YShift;const t=this.PlayerBaseY+this.YShiftBase+this.YShift;for(let e=0;e<this.enemys.length;e++)for(let i=0;i<this.enemys[e].enemysOnFloor.length;i++)if(this.enemys[e].enemysOnFloor[i]!=null){const n=this.enemys[e].enemysOnFloor[i];n.animEnemy.y=t-e*this.othersFloorShift,n.bitmapTextHP.y=n.animEnemy.y-this.bitmapHPUpSHift}}update(t){if(this.updatePlayerStatesDrawed(),this.beforeFrameTime==-1e3){this.beforeFrameTime=t;return}const e=t-this.beforeFrameTime;this.beforeFrameTime=t,this.moving&&(A(e>=0),this.curMovingTime+=e/1e3,this.curMovingTime<this.VFromT.lastX()?(this.YShift=this.VFromT.area(this.curMovingTime),this.updateCoords()):(this.YShiftBase+=this.VFromT.area(this.VFromT.lastX()),this.VFromT=null,this.moving=!1,this.YShift=0,this.updateCoords(),this.currentFloor++,A(this.playerStates.length!=0),this.playerStates.splice(0,1),this.startNextPlayerState()))}createPlayer(){this.animPlayer=y.getSpineAnimation("tower_player"),this.animPlayer.x=this.playerLadderPosX,this.animPlayer.y=this.PlayerBaseY,this.animPlayer.scale.set(this.playerScale,this.playerScale),this.towerContainer.addChild(this.animPlayer),this.animPlayer.state.setAnimation(0,"idle",!0)}createEnemys(){for(let t=0;t<this.sprFloors.length;t++){const e=new Vs;if(this.enemys.push(e),t>this.numberFloors-1)continue;const i=[];for(let o=0;o<4;o++)i.push(o);const n=V(1,3);for(;i.length>n;){const o=V(0,i.length-1);i.splice(o,1)}A(i.length>0);for(let o=0;o<i.length;o++){const r=y.getSpineAnimation("tower_enemy");r.name="enemy",r.x=this.enemyX[i[o]],r.y=this.PlayerBaseY-t*this.othersFloorShift;const l=.3;i[o]<2?r.scale.set(-l,l):r.scale.set(l,l),this.towerContainer.addChild(r),r.state.setAnimation(0,"idle",!0).trackTime=V(0,30)/30;const d=V(1,9),g=new f(d.toString(),{fontName:"Inter",fontSize:30});for(g.name="hp",g.x=r.x-10,g.y=r.y-this.bitmapHPUpSHift,this.towerContainer.addChild(g);e.enemysOnFloor.length<i[o];)e.enemysOnFloor.push(null);const u=new Ws;u.animEnemy=r,u.numHP=d,u.bitmapTextHP=g,e.enemysOnFloor.push(u),A(e.enemysOnFloor.length<=4)}}}getEnemyRects(){let t=this.currentFloor;const e=[];if(this.moving)return e;let i=0;t&&(i=83);for(let n=0;n<this.NumFloorsForRect;n++)this.getEnemyRectsOneFloor(t,e,i-n*this.othersFloorShift),t++;return e}getEnemyRectsOneFloor(t,e,i){const n=t,o=this.enemys[n].enemysOnFloor;let r=!1;o[0]!=null&&!o[0].dead&&(r=!0);let l=!1;o[1]!=null&&!o[1].dead&&(l=!0);let d=!1;o[2]!=null&&!o[2].dead&&(d=!0);let g=!1;if(o[3]!=null&&!o[3].dead&&(g=!0),r||l){const u=new we;u.floor=n,r&&l&&(u.enemyId=1,u.rect.x=this.enemyX[0]-this.enemyPivotShifLeft,u.rect.y=this.PlayerBaseY-this.enemyPivotShifUp+i,u.rect.width=this.enemys[n].enemysOnFloor[1].animEnemy.x+this.enemyWidth-this.enemys[n].enemysOnFloor[0].animEnemy.x,u.rect.height=this.enemyHeight,e.push(u)),!r&&l&&(u.enemyId=1,u.rect.x=this.enemyX[1]-this.enemyPivotShifLeft,u.rect.y=this.PlayerBaseY-this.enemyPivotShifUp+i,u.rect.width=this.enemyWidth,u.rect.height=this.enemyHeight,e.push(u)),r&&!l&&(u.enemyId=0,u.rect.x=this.enemyX[0]-this.enemyPivotShifLeft,u.rect.y=this.PlayerBaseY-this.enemyPivotShifUp+i,u.rect.width=this.enemyWidth,u.rect.height=this.enemyHeight,e.push(u))}if(d||g){const u=new we;u.floor=n,d&&g&&(u.enemyId=2,u.rect.x=this.enemyX[2]-this.enemyPivotShifLeft,u.rect.y=this.PlayerBaseY-this.enemyPivotShifUp+i,u.rect.width=this.enemys[n].enemysOnFloor[3].animEnemy.x+this.enemyWidth-this.enemys[n].enemysOnFloor[2].animEnemy.x,u.rect.height=this.enemyHeight,e.push(u)),!d&&g&&(u.enemyId=3,u.rect.x=this.enemyX[3]-this.enemyPivotShifLeft,u.rect.y=this.PlayerBaseY-this.enemyPivotShifUp+i,u.rect.width=this.enemyWidth,u.rect.height=this.enemyHeight,e.push(u)),d&&!g&&(u.enemyId=2,u.rect.x=this.enemyX[2]-this.enemyPivotShifLeft,u.rect.y=this.PlayerBaseY-this.enemyPivotShifUp+i,u.rect.width=this.enemyWidth,u.rect.height=this.enemyHeight,e.push(u))}return e}clearHitRects(){for(;this.grHitRects.length;){const t=this.grHitRects[0];this.grHitRects.splice(0,1),this.towerContainer.removeChild(t)}}drawHitRects(){this.clearHitRects();const t=this.getEnemyRects();for(let e=0;e<t.length;e++){const i=new R;i.lineStyle(2,65280);const n=t[e];A(n!=null);const o=t[e].rect;i.moveTo(o.x,o.y),i.lineTo(o.x+o.width,o.y),i.lineTo(o.x+o.width,o.y+o.height),i.lineTo(o.x,o.y+o.height),i.lineTo(o.x,o.y),this.towerContainer.addChild(i),this.grHitRects.push(i)}}getPlayerStateById(t){switch(t){case 0:return"Climb";case 1:return"ClimbStart";case 2:return"ClimbMiddle";case 3:return"ClimbEnd";case 4:return"ClimbDown";case 5:return"ClimbDownStart";case 6:return"ClimbDownMiddle";case 7:return"ClimbDownEnd";case 9:return"Walk";case 8:return"CameraUp";case 10:return"Walk2Monster";case 11:return"Walk2Ladder";default:A(!1)}return""}updatePlayerStatesDrawed(){for(;this.playerStatesDrawed.length;){const e=this.playerStatesDrawed[0];this.playerStatesDrawed.splice(0,1),this.towerContainer.removeChild(e)}let t=100;for(let e=0;e<this.playerStates.length;e++){const i=this.getPlayerStateById(this.playerStates[e]),n=new f(i,{fontName:"Inter",fontSize:18});n.x=10,n.y=t,t+=20,this.towerContainer.addChild(n),this.playerStatesDrawed.push(n)}}climbLadderUp(){this.clearHitRects();let t;switch(this.playerStates[0]){case 0:t="climb";break;case 1:t="climb_start";break;case 2:t="climb_mid";break;case 3:t="climb_end";break;default:A(!1)}this.animPlayer.state.setAnimation(0,t,!0),this.playerStates[0]==0||this.playerStates[0]==1?this.playerTimeout1=setTimeout(this.climbLadderUp1.bind(this),500):this.climbLadderUp1()}climbLadderUp1(){new T.Tween(this.animPlayer).to({y:this.animPlayer.y-this.othersFloorShift},2e3-33).easing(T.Easing.Linear.None).onComplete(this.climbLadderUp2.bind(this)).start()}climbLadderUp2(){this.playerStates[0]==0||this.playerStates[0]==3?this.playerTimeout1=setTimeout(this.onClimbLadderUpFinish.bind(this),500):this.onClimbLadderUpFinish()}onClimbLadderUpFinish(){this.playerFloor++,this.playerStates.length==1&&(this.playerStates[0]==0||this.playerStates[0]==3)&&this.animPlayer.state.setAnimation(0,"idle",!0),this.playerStates.splice(0,1),this.startNextPlayerState()}climbLadderDown(){this.clearHitRects();let t;switch(this.playerStates[0]){case 4:t="climb";break;case 5:t="climb_start";break;case 6:t="climb_mid";break;case 7:t="climb_end";break;default:A(!1)}this.animPlayer.state.setAnimation(0,t,!0),this.playerStates[0]==4||this.playerStates[0]==5?this.playerTimeout1=setTimeout(this.climbLadderDown1.bind(this),500):this.climbLadderDown1()}climbLadderDown1(){new T.Tween(this.animPlayer).to({y:this.animPlayer.y+this.othersFloorShift},2e3-33).easing(T.Easing.Linear.None).onComplete(this.climbLadderDown2.bind(this)).start()}climbLadderDown2(){this.playerStates[0]==4||this.playerStates[0]==7?this.playerTimeout1=setTimeout(this.onClimbLadderDownFinish.bind(this),500):this.onClimbLadderDownFinish()}onClimbLadderDownFinish(){this.playerFloor--,this.playerStates.length==1&&(this.playerStates[0]==4||this.playerStates[0]==7)&&this.animPlayer.state.setAnimation(0,"idle",!0),this.playerStates.splice(0,1),this.startNextPlayerState()}walk2Monster(){let t=!0;this.targetEnemy.rect.x>this.animPlayer.x&&(t=!1),t?(this.playerWalkTargetX=this.targetEnemy.rect.x+this.targetEnemy.rect.width+this.player2enemyDistX,this.animPlayer.scale.x=this.playerScale):(this.playerWalkTargetX=this.targetEnemy.rect.x-this.player2enemyDistX,this.animPlayer.scale.x=-this.playerScale);let e=this.playerWalkTargetX-this.animPlayer.x;e>0?this.animPlayer.scale.x=-this.playerScale:this.animPlayer.scale.x=this.playerScale,e=Math.abs(e);const i=e/this.playerWalkSpeed;new T.Tween(this.animPlayer).to({x:this.playerWalkTargetX},i*1e3).easing(T.Easing.Linear.None).onComplete(this.onWalk2MonsterFinish.bind(this)).start(),this.animPlayer.state.setAnimation(0,"walk",!0),this.animPlayer.state.timeScale=this.playerWalkAnimModifyer}onWalk2MonsterFinish(){this.animPlayer.state.timeScale=1,this.animPlayer.state.setAnimation(0,"swing",!1),this.playerTimeout1=setTimeout(this.onSwingEnd.bind(this),2e3),this.playerTimeout2=setTimeout(this.onEnemyHit.bind(this),1e3)}onEnemyHit(){const t=this.enemys[this.targetEnemy.floor].enemysOnFloor[this.targetEnemy.enemyId];t.animEnemy.state.setAnimation(0,"death",!1),t.dead=!0,this.towerContainer.removeChild(t.bitmapTextHP),this.drawHitRects();const e=this.store.getState(),{activePlayer:i}=e.activePlayer;this.store.dispatch(j(i,t.numHP,$t))}onSwingEnd(){if(console.log(`onSwingEnd playerStates.len = ${this.playerStates.length}`),this.animPlayer.state.setAnimation(0,"idle",!0),A(this.playerStates.length!=0),this.playerStates.splice(0,1),!this.haveEnemyOnTower()){this.switchSceneTo(m.SCORE_SCENE);return}if(console.log(`onSwingEnd playerStates.len = ${this.playerStates.length}`),this.currentFloor+this.NumFloorsForRect<this.numberFloors)if(this.currentFloor==this.playerFloor&&!this.numEnemyOnFloor(this.currentFloor))this.playerStates.push(11),this.playerStates.push(0),this.playerStates.push(8),this.currentFloor+1+this.NumFloorsForRect<this.numberFloors&&!this.numEnemyOnFloor(this.currentFloor+1)&&(this.playerStates.push(0),this.playerStates.push(8)),this.drawHitRects();else{let t=0;for(let e=this.currentFloor;e<this.currentFloor+this.NumFloorsForRect;e++)t+=this.numEnemyOnFloor(e);t<4&&(this.currentFloor==this.playerFloor&&(this.playerStates.push(11),this.playerStates.push(0)),this.playerStates.push(8),this.currentFloor+1+this.NumFloorsForRect<this.numberFloors&&!this.numEnemyOnFloor(this.currentFloor+1)&&(this.currentFloor!=this.playerFloor&&this.playerStates.push(11),this.playerStates.push(0),this.playerStates.push(8)))}this.startNextPlayerState()}walk2Ladder(){let t=this.playerLadderPosX-this.animPlayer.x;t>0?this.animPlayer.scale.x=-this.playerScale:this.animPlayer.scale.x=this.playerScale,t=Math.abs(t);const e=t/this.playerWalkSpeed;new T.Tween(this.animPlayer).to({x:this.playerLadderPosX},e*1e3).easing(T.Easing.Linear.None).onComplete(this.onWwalk2LadderFinish.bind(this)).start(),this.animPlayer.state.setAnimation(0,"walk",!0),this.animPlayer.state.timeScale=this.playerWalkAnimModifyer}onWwalk2LadderFinish(){this.animPlayer.state.timeScale=1,this.animPlayer.state.setAnimation(0,"idle",!0),A(this.playerStates.length!=0),this.playerStates.splice(0,1),this.startNextPlayerState()}numEnemyOnFloor(t){const e=this.enemys[t].enemysOnFloor;let i=0;return e[0]!=null&&!e[0].dead&&i++,e[1]!=null&&!e[1].dead&&i++,e[2]!=null&&!e[2].dead&&i++,e[3]!=null&&!e[3].dead&&i++,i}haveEnemyOnTower(){for(let t=this.currentFloor;t<this.enemys.length;t++)if(this.numEnemyOnFloor(t))return!0;return!1}}const Te=272,Ee=20,ve=3,$=new Map;$.set("Lucky",m.LUCKY_SCENE);$.set("Target",m.TARGET_SCENE);$.set("Survival",m.SURVIVAL_SCENE);$.set("MiniTarget",m.MINI_TARGET_SCENE);$.set("Boss",m.MINESWEEPER_SCENE);$.set("FlattenedTarget",m.FLATTTENED_TARGET_SCENE);$.set("Tower",m.TOWER_SCENE);const $s={Lucky:"Hitter",Target:"Target",Survival:"Boxes",MiniTarget:"Mini targets",Boss:"Tresure Hunt",FlattenedTarget:"FlattenedTarget",Tower:"Tower"};class zs extends K{constructor(){super(...arguments);a(this,"menuEntries");a(this,"menuContainer");a(this,"storeUnsub");a(this,"resetClicks",0);a(this,"playersList");a(this,"resetPlayersBtn")}setup(){this.menuEntries=[],this.menuContainer=new N,this.centered.addChild(this.menuContainer);for(const r of $.keys()){let l=!0;r=="Tower"&&(l=!1),l&&this.createMiniGameIcon(r,$s[r])}this.menuContainer.scale.set(.65),this.menuContainer.x=-this.menuContainer.width/2,this.menuContainer.y=-this.menuContainer.height/2;const t=this.createButton("Reset players",260,60);this.resetPlayersBtn=t,t.on("mousedown",this.resetSession,this),t.on("touchstart",this.resetSession,this);const e=p().call(nt).addTo(this._sceneContainer).sp,i=300,n=300,o=this.createGraphicsButton("Reset position",i,n);if(o.alpha=0,o.on("mousedown",this.resetPosition,this),o.on("touchstart",this.resetPosition,this),o.x=e.x-i/2,o.y=e.y-n/2,this.playersList=new it(this.store,m.MENU_SCENE),p(this.playersList).pos(z,X).addTo(this._sceneContainer),this.store.dispatch(Qe(0)),this.storeUnsub=this.store.subscribe(this.updateState.bind(this)),this.updateState(),window.__TAURI__){const r=new f(Tt().machineId.substring(0,4),{fontName:"Desyrel"});this._sceneContainer.addChild(r)}this.store.dispatch(ie(m.MENU_SCENE))}teardown(){this.stage.removeChild(this.menuContainer),this.menuContainer=null;for(const t of this.menuEntries)t.removeAllListeners();this.menuEntries=null,this.storeUnsub()}updateState(){const t=this.store.getState();this.resetPlayersBtn.visible=t.players.length>1,this.playersList.updateState(t)}createGraphicsButton(t,e=260,i=50){const n=new R,o=20;n.x=M-e-o,n.y=lt-i-o,n.beginFill(0),n.drawRect(0,0,e,i),this.sceneContainer.addChild(n);const r=()=>{n.clear(),n.beginFill(12632256),n.drawRect(0,0,e,i)},l=()=>{n.clear(),n.beginFill(0),n.drawRect(0,0,e,i)};n.on("mouseover",r,this),n.on("mouseout",l,this),n.interactive=!0;const d=new f(t,{fontName:"Desyrel"});return d.x=n.width/2-d.width/2,d.y=n.height/2-d.height/2,n.addChild(d),n}createButton(t,e=260,i=50){const n=p("gui/light_btn.png").anc(0,0).addTo(this.sceneContainer).sp,o=20;n.x=M-e-o+10,n.y=lt-i-o-230,n.interactive=!0;const r=()=>{d.clear(),d.beginFill(0,.2),d.drawRect(0,0,e,i)},l=()=>{d.clear(),d.beginFill(12632256,0),d.drawRect(0,0,e,i)};n.on("mouseover",r,this),n.on("mouseout",l,this);const d=new R;n.addChild(d),l();const g=new f(t,{fontName:"Desyrel"});return g.anchor.set(.5,.5),g.x=e/2,g.y=i/2,d.addChild(g),n}resetPosition(){this.resetClicks++,this.resetClicks>5&&(this.resetClicks=0,localStorage.removeItem("cachedPosition"),this.sceneManager.updateScenePosition=!0,this.sceneManager._updateScenePosition(!0))}resetSession(t){this.store.dispatch(ts()),this.store.dispatch(ue())}createMiniGameIcon(t,e=""){const i=(Te+Ee)*(this.menuEntries.length%ve),n=(Te+Ee)*Math.floor(this.menuEntries.length/ve),o="main/menu_"+t.toLowerCase()+".png",r=p(o).anc(0,0).pos(i,n).scale(1).addTo(this.menuContainer).sp;r.interactive=!0,r.sceneKey=t,r.on("mousedown",this.onMenuEntryClick,this),r.on("touchstart",this.onMenuEntryClick,this);const l=new f(e,{fontName:"Desyrel"});l.x=r.width/2-l.width/2,l.y=r.height/2-l.height/2,r.addChild(l),this.menuEntries.push(r)}onMenuEntryClick(t){const i=t.target.sceneKey;if(!i)throw new Error("no scene key");const n=$.get(i);Tt().send(i),this.store.dispatch(ie(n)),this.switchSceneTo(n)}tick(){}}let Xt;const Kt=m.LUCKY_SCENE;class Xs extends K{constructor(){super(...arguments);a(this,"container");a(this,"target");a(this,"background");a(this,"counter");a(this,"counterValue",1);a(this,"menuItem");a(this,"storeUnsub");a(this,"playersList");a(this,"explosionAnimation");a(this,"shieldId",0);a(this,"blackBackground")}setup(){this.shieldId=0,this.counterValue=1,this.target=new N,this.target.interactive=!0,this.target.on("mousedown",this.onClick,this),this.target.on("touchstart",this.onClick,this),this.sceneContainer.addChild(this.target),this.playersList=new it(this.store,Kt),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),p(this.playersList).pos(z,X).addTo(this._sceneContainer),Xt=pt(()=>{const i=this.store.getState(),{activePlayer:n}=i.activePlayer;this.store.dispatch(O(n,Kt))}),Xt.interactive=!0,this._sceneContainer.addChild(Xt),this.background=p().anc(.8,.8).scale(.5,.5).anc(.5,.5).addTo(this.target).sp,this.background.texture=y.getTexture("main/shield_0.png");const t=new f("0",{fontName:"Desyrel",fontSize:60,align:"center"});this.counter=t,this.target.addChild(t);const e=()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())};this.menuItem=dt(e),this._sceneContainer.addChild(this.menuItem),ut(this._sceneContainer),p().call(nt).addTo(this._sceneContainer),this.storeUnsub=this.store.subscribe(this.updateState.bind(this)),this.updateState(),this.addExplosionAnimation(),this.updateTargetPosition()}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.sceneContainer).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}updateState(){const t=this.store.getState();this.playersList.updateState(t)}onClick(){P.play("boing");const{x:t,y:e}=this.target.position;this.explosion(t,e);const i=this.store.getState(),{activePlayer:n}=i.activePlayer;this.store.dispatch(j(n,this.counterValue,Kt)),this.counterValue*=2,this.shieldId++,this.shieldId>5&&(this.counterValue=1,this.shieldId=0),this.background.texture=y.getTexture(`main/shield_${this.shieldId}.png`),this.updateTargetPosition()}updateTargetPosition(){this.counter.text=this.counterValue+"";const t=-this.counter.width/2,e=-this.counter.height/2;console.log(t+" x "+e),this.counter.x=-this.counter.width/2,this.counter.y=-150;const i=150,n=V(i,M-i),o=V(se+i,se+qe-i);this.target.position.set(n,o)}teardown(){this.container=null,this.target.removeAllListeners(),this.target=null,this.menuItem.removeAllListeners(),this.menuItem=null,this.counterValue=0}tick(){}get maxW(){return M*.4}get maxH(){return lt*.4}}const Ks="bomb",qt={knife:{image:"gui/knife.png",damage:10},club:{image:"gui/club.png",damage:20},sword:{image:"gui/sword.png",damage:30},hammer:{image:"gui/hammer.png",damage:40},axe:{image:"gui/axe.png",damage:50},bomb:{image:"gui/bomb.png",damage:0}};var D,tt,At,Pt,ht,Mt,W;class qs extends x{constructor(){super();C(this,D,void 0);C(this,tt,void 0);C(this,At,void 0);C(this,Pt,void 0);C(this,ht,void 0);C(this,Mt,void 0);C(this,W,void 0);b(this,D,new f("0",{fontName:"Desyrel",fontSize:35})),this.updateLabelPosition(),this.addChild(c(this,D)),this.setRandomTypeNotBomb(),b(this,W,p("gui/frame.png").size(E,E).hide().anc(.5,.5).addTo(this).sp);const t={from:.45,to:.4};c(this,W).scale.set(t.from,t.from);const e=1e3;new T.Tween(c(this,W).scale).repeat(1/0).to({x:t.to,y:t.to},e).easing(T.Easing.Quadratic.Out).start(),new T.Tween(c(this,W)).repeat(1/0).to({alpha:0},e).easing(T.Easing.Quadratic.Out).start(),this.on("mouseover",this.onMouseOver,this),this.on("mouseout",this.onMouseOut,this)}get xColumn(){return c(this,At)}set xColumn(t){b(this,At,t)}get yRow(){return c(this,Pt)}set yRow(t){b(this,Pt,t)}get damage(){return c(this,ht)}set damage(t){t!==c(this,ht)&&(c(this,D).text=t.toString(),b(this,ht,t),this.updateLabelPosition())}set type(t){c(this,tt)&&(c(this,tt).parent.removeChild(c(this,tt)),b(this,tt,null));const{image:e,damage:i}=qt[t];b(this,Mt,t),b(this,tt,p(e).addAt(this,0).anc(.5,.5).size(E,E).sp),this.damage=i,this.updateLabelPosition()}get type(){return c(this,Mt)}onMouseOver(){c(this,W).visible=!0}onMouseOut(){c(this,W).visible=!1}updateLabelPosition(){c(this,D).visible=c(this,ht)>0,c(this,D).position.set(-c(this,D).width/2+20,-c(this,D).height/2+30)}setRandomType(){const t=Object.keys(qt),e=Math.floor(Math.random()*t.length),i=t[e];this.type=i}setRandomTypeNotBomb(){const t=Object.keys(qt).filter(n=>n!==Ks),e=Math.floor(Math.random()*t.length),i=t[e];this.type=i}}D=new WeakMap,tt=new WeakMap,At=new WeakMap,Pt=new WeakMap,ht=new WeakMap,Mt=new WeakMap,W=new WeakMap;const Zt=m.SURVIVAL_SCENE,Jt=6,Qt=6;class Zs extends N{constructor(){super(...arguments);a(this,"isOpen");a(this,"boxbg");a(this,"box")}}class Js extends K{constructor(){super(...arguments);a(this,"menuItem");a(this,"boardContainer");a(this,"board");a(this,"targets");a(this,"targetPositions");a(this,"explosionAnimation");a(this,"counterValue");a(this,"storeUnsub");a(this,"playersList");a(this,"clickCounter");a(this,"missMenuBtn");a(this,"totalTargetsAmount",3)}setup(){const t=()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())};this.menuItem=dt(t),this._sceneContainer.addChild(this.menuItem),ut(this._sceneContainer),p().call(nt).addTo(this._sceneContainer),this.boardContainer=new N,this.boardContainer.position.set(M/2,lt/2-70),this._sceneContainer.addChild(this.boardContainer),this.addExplosionAnimation(),this.playersList=new it(this.store,Zt),p(this.playersList).pos(z,X).addTo(this._sceneContainer),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),this.missMenuBtn=pt(()=>{const e=this.store.getState(),{activePlayer:i}=e.activePlayer;this.store.dispatch(O(i,Zt))}),this.missMenuBtn.interactive=!0,this._sceneContainer.addChild(this.missMenuBtn),this.storeUnsub=this.store.subscribe(this.updateState.bind(this)),this.updateState(),this.resetBoard()}updateState(){const t=this.store.getState();this.playersList.updateState(t)}resetBoard(){this.totalTargetsAmount=16,this.counterValue=0,this.clickCounter=0,this.createBoard(),this.targets=[];for(let t=0;t<this.totalTargetsAmount;t++)this.createCounter();for(const[t,e]of Object.entries(this.targetPositions)){const{x:i,y:n}=e,o=this.board[i][n].position;this.targets[t].position.set(o.x,o.y)}}teardown(){}createCounter(){const t=new Zs;t.interactive=!0,this.boardContainer.addChild(t),t.isOpen=!1,t.boxbg=p("main/box2.png").scale(.8).anc(.5,.5).addTo(t).sp;const e=new f("0",{fontName:"Desyrel",fontSize:60});this.counterValue++,e.text=this.counterValue+"",e.x=-e.width/2,e.y=-e.height/2,t.addChild(e),t.box=p("main/box.png").scale(.8).anc(.5,.5).addTo(t).sp,this.targets.push(t);const i=this.onBoardClick.bind(this,t);t.on("mousedown",i),t.on("touchstart",i)}onBoardClick(t){if(P.play("boing"),console.log("board clicked"),!t.isOpen){t.box.visible=!1,t.isOpen=!0;return}const e=this.store.getState(),{activePlayer:i}=e.activePlayer,n=this.targets.indexOf(t)+1;this.store.dispatch(j(i,n,Zt)),this.clickCounter++,this.clickCounter>=this.totalTargetsAmount&&this.resetBoard(),t.visible=!1;const{x:o,y:r}=t;this.explosion(o,r)}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.boardContainer).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}createBoard(){const t=Jt*E/2,e=Qt*E/2;this.board=new Array(Qt);for(let n=0;n<Qt;n++){const o=new Array(Jt);for(let r=0;r<Jt;r++){const l=new qs;l.xColumn=r,l.yRow=n,l.visible=!1,p(l).pos(-t+E/2+r*E,120-e+E/2+n*E).addTo(this.boardContainer),o[r]=l}this.board[n]=o}const i=()=>({x:V(1,4),y:V(1,4)});this.targetPositions=[];for(let n=0;n<this.totalTargetsAmount;n++){let o,r=!0;for(;r;){o=i(),r=!1;for(const l of this.targetPositions)l.x===o.x&&l.y===o.y&&(r=!0)}this.targetPositions.push(o)}}tick(){}}const Qs=[];function _e(){return{[m.LUCKY_SCENE]:{hit:0,miss:0,score:0},[m.SURVIVAL_SCENE]:{hit:0,miss:0,score:0},[m.TARGET_SCENE]:{hit:0,miss:0,score:0},[m.MINI_TARGET_SCENE]:{hit:0,miss:0,score:0},[m.MINESWEEPER_SCENE]:{hit:0,miss:0,score:0},[m.FLATTTENED_TARGET_SCENE]:{hit:0,miss:0,score:0},[m.TOWER_SCENE]:{hit:0,miss:0,score:0}}}function ti(h=Qs,s){switch(s.type){case re:return[...h,_e()];case he:return h.map((t,e)=>{if(e===s.payload.player){const i=s.payload.game,{hit:n,score:o}=t[i],r=n+1,l=o+s.payload.score;t[i]=Object.assign(t[i],{hit:r,score:l})}return t});case le:return h.map((t,e)=>{if(isNaN(s.payload.player))throw"player is missing for miss";if(e===s.payload.player){const i=s.payload.game,{hit:n,miss:o}=t[i],r=o+1;t[i]=Object.assign(t[i],{hit:n,miss:r})}return t});case ce:return[];case de:return h.map((t,e)=>_e());default:return h}}const ei={totalPlayers:0,activePlayer:0};function si(h=ei,s){let t;switch(s.type){case re:return{...h,totalPlayers:h.totalPlayers+1};case he:return t=h.activePlayer,t===h.totalPlayers-1?t=0:t++,{...h,activePlayer:t};case le:return t=h.activePlayer,t===h.totalPlayers-1?t=0:t++,{...h,activePlayer:t};case Ze:return{...h,activePlayer:s.payload.player};case ce:return{totalPlayers:0,activePlayer:0};case de:return{...h,activePlayer:0};default:return h}}const ii={activeGame:0};function ni(h=ii,s){switch(s.type){case Je:return{activeGame:s.payload.game};default:return h}}const oi=ds({players:ti,activePlayer:si,activeGame:ni});function ai(){return us(oi)}let S=null,ne=!1;document.addEventListener("keyup",function(h){S&&h.stopImmediatePropagation()});document.addEventListener("keydown",function(h){let s=0,t=0;switch(h.key){case"ArrowLeft":s=-1;break;case"ArrowRight":s=1;break;case"ArrowUp":t=-1;break;case"ArrowDown":t=1;break}if(!(s===0&&t===0)&&(h.shiftKey&&(s*=10,t*=10),h.ctrlKey&&(s*=10,t*=10),!!S)){if(h.altKey){S.rotation+=s*Math.PI/180;const e=Math.max(S.scale.x-S.scale.x*t/100,1e-5),i=Math.max(S.scale.y-S.scale.y*t/100,1e-5);S.scale.set(e,i)}else S.position.x+=s,S.position.y+=t;if(console.log(`.pos(${S.position.x}, ${S.position.y}).sc(${S.scale.x}, ${S.scale.y})`),ne){const e=JSON.stringify({x:S.position.x,y:S.position.y,rotation:S.rotation,scaleX:S.scale.x,scaleY:S.scale.y});localStorage.setItem("cachedPosition",e)}}});function Ae(h,s=!1){if(ne=s,S=h,h.position.x,h.position.y,h.rotation,s){const t=localStorage.getItem("cachedPosition");if(t)try{const e=JSON.parse(t);S.position.x=e.x,S.position.y=e.y,S.rotation=e.rotation,S.scale.x=e.scaleX,S.scale.y=e.scaleY}catch{ne=!1,localStorage.removeItem("cachedPosition")}}}function ri(){S=null}const Pe=200,Me=20;class hi extends K{constructor(){super(...arguments);a(this,"playerEntries");a(this,"menuContainer");a(this,"storeUnsub");a(this,"_rows");a(this,"_nameLabels");a(this,"_hitLabels");a(this,"_missLabels");a(this,"_scoreLabels");a(this,"_emojis");a(this,"_isUpdated",!1)}setup(){this.playerEntries=[],this._isUpdated=!1,p("temp/game_result_bg.png").anc(.5,.5).addTo(this.centered),this.menuContainer=new N,this.centered.addChild(this.menuContainer),this.menuContainer.x=-(Pe*2+Me)/2,this.menuContainer.y=-(Pe*2+Me)/2;const t=p().pos(-333,435).sc(.08862938119652503,.08862938119652503).addTo(this.centered).sp;Ns(t,!1),this._rows=[],this._nameLabels=[],this._emojis=[],this._hitLabels=[],this._missLabels=[],this._scoreLabels=[];for(let i=0;i<10;i++){const n=p("temp/row.png").pos(-302,-453+i*70).sc(1,1).addTo(this.centered).sp,o=new f("name",{fontName:"Desyrel"});o.x=62,o.y=15,n.addChild(o),this._nameLabels.push(o);const r=p("emoji/1.png").pos(36,32).anc(.5,.5).addTo(n).sp;this._emojis.push(r);const l=new f("0",{fontName:"Desyrel"});l.x=315,l.y=15,n.addChild(l),this._hitLabels.push(l);const d=new f("0",{fontName:"Desyrel"});d.x=388,d.y=15,n.addChild(d),this._missLabels.push(d);const g=new f("0",{fontName:"Desyrel"});g.x=488,g.y=15,n.addChild(g),this._scoreLabels.push(g),this._rows.push(n)}this.storeUnsub=this.store.subscribe(this.updateState.bind(this)),this.updateState();const e=vs(this.backToPreviousGame,this);p(e).pos(-131,465).addTo(this.centered)}backToPreviousGame(){this.store.dispatch(st());const t=this.store.getState(),{activeGame:e}=t.activeGame;this.switchSceneTo(e)}teardown(){this.stage.removeChild(this.menuContainer),this.menuContainer=null,this.playerEntries=null,this.storeUnsub()}updateState(){const t=this.store.getState(),{activeGame:e}=t.activeGame;if(e&&!this._isUpdated){this._isUpdated=!0,Tt().send(e+"_menu");for(let i=0;i<this._rows.length;i++){const n=t.players[i],o=!!n;if(this._rows[i].visible=o,n){const{hit:r,miss:l,score:d}=n[e];this._nameLabels[i].text="Player "+(i+1),this._scoreLabels[i].text=d+"",this._hitLabels[i].text=r+"",this._missLabels[i].text=l+"",this._emojis[i].texture=y.getTexture("emoji/"+(i+1)+".png")}}}}createButton(t,e,i,n=0){const o=new R;o.x=n,o.y=650,o.beginFill(14991865),o.drawRect(0,0,200,100),this.menuContainer.addChild(o),o.interactive=!0,o.on("mousedown",e,i),o.on("touchstart",e,i);const r=new f(t,{fontName:"sans-serif"});r.x=o.width/2-r.width/2,r.y=o.height/2-r.height/2,o.addChild(r)}resetSession(t){this.store.dispatch(ts())}tick(){}}const li={start:1,end:1},ci={start:1,end:.001,minimumScaleMultiplier:1},di={start:"#ffffff",end:"#ffffff"},ui={start:100,end:0,minimumSpeedMultiplier:1},pi={x:0,y:200},mi=0,gi={min:0,max:360},yi=!1,fi={min:60,max:90},Si={min:1.1,max:1.3},bi="normal",Ci=[{s:0,cp:.329,e:.548},{s:.548,cp:.767,e:.876},{s:.876,cp:.985,e:1}],xi=.01,wi=.1,Ti=100,Ei={x:0,y:0},vi=!0,_i="point",Ai={alpha:li,scale:ci,color:di,speed:ui,acceleration:pi,maxSpeed:mi,startRotation:gi,noRotation:yi,rotationSpeed:fi,lifetime:Si,blendMode:bi,ease:Ci,frequency:xi,emitterLifetime:wi,maxParticles:Ti,pos:Ei,addAtBack:vi,spawnType:_i};let Bt=null;function Pi(h){if(Bt===null){const s=ps(Ai,y.getTexture("gui/dark.png"));Bt=new ms(h,s)}else Bt.parent=h;return Bt}const Ot=m.MINESWEEPER_SCENE,at=7,rt=7,Le=7;let Fe=Date.now();class Mi{constructor(s){a(this,"isMine");a(this,"isCovered");a(this,"isFlagged");a(this,"adjacentMines");this.isMine=s,this.isCovered=!0,this.isFlagged=!1,this.adjacentMines=0}}class Ne{constructor(s,t,e){a(this,"grid");do{this.grid=Array.from({length:s},()=>Array.from({length:t},()=>new Mi(!1)));const i=s*t,n=new Set;for(;n.size<e;){const o=Math.floor(Math.random()*i);n.add(o)}for(const o of n){const r=Math.floor(o/t),l=o%t;this.grid[r][l].isMine=!0}}while(!this.calculateAdjacentMines())}calculateAdjacentMines(){const s=this.grid.length,t=this.grid[0].length;for(let e=0;e<s;e++)for(let i=0;i<t;i++)if(!this.grid[e][i].isMine){let n=0;for(let o=-1;o<=1;o++)for(let r=-1;r<=1;r++){const l=e+o,d=i+r;l>=0&&l<s&&d>=0&&d<t&&this.grid[l][d].isMine&&n++}if(this.grid[e][i].adjacentMines=n,!(n==0||n==1||n==2||n==3||n==5))return!1}return!0}isGameWon(){for(const s of this.grid)for(const t of s)if(t.isMine&&t.isCovered)return!1;return!0}isAllCellsUncovered(){for(const s of this.grid)for(const t of s)if(t.isCovered)return!1;return!0}uncover(s,t){const e=this.grid[s][t];if(e.isCovered){if(e.isCovered=!1,e.isMine)return!1;if(e.adjacentMines===0)for(let i=-1;i<=1;i++)for(let n=-1;n<=1;n++){const o=s+i,r=t+n;o>=0&&o<this.grid.length&&r>=0&&r<this.grid[0].length&&this.uncover(o,r)}}return!0}}var k,I,H,_,B,G,bt;class Li extends x{constructor(t){super();C(this,k,-1);C(this,I,-1);C(this,H,void 0);a(this,"isEven");a(this,"isUncovered");a(this,"scene");C(this,_,void 0);C(this,B,void 0);C(this,G,void 0);C(this,bt,!1);this.scene=t,b(this,H,p("gui/dark.png").size(this.width,this.height).addTo(this).sp),b(this,G,this.getChestAnimation()),c(this,G).visible=!1,c(this,G).position.set(.5,.5),b(this,_,p("gui/dark.png").hide().anc(.5,.5).pos(this.width/2,this.height/2).size(this.width,this.height).addTo(this).sp),this.interactive=!0,this.on("mouseover",this.onMouseOver,this),this.on("mouseout",this.onMouseOut,this),this.on("touchstart",this.onMouseClick,this),this.on("mousedown",this.onMouseClick,this)}get xColumn(){return c(this,k)}set xColumn(t){b(this,k,t),this.updateGraphics()}get yRow(){return c(this,I)}set yRow(t){b(this,I,t),this.updateGraphics()}hideContnt(){c(this,_).visible=!1,c(this,_).width=1,c(this,_).height=1,c(this,G).visible=!1,b(this,bt,!1)}getChestAnimation(){const t=y.getSpineAnimation("chest"),e=.0025;return t.scale.set(e,e),this.addChild(t),t}playChestOpenAnimation(){const t=c(this,G);if(t.state.hasAnimation("animation"))t.state.setAnimation(0,"animation",!1),t.state.timeScale=1,setTimeout(()=>{t.state.setAnimation(0,"idle",!0)},2e3);else throw new Error("spine animation missing")}updateGraphics(){if(c(this,k)<0||c(this,I)<0)return;b(this,B,this.scene.mGrid.grid[c(this,I)][c(this,k)]);const t=c(this,I)%2===0;if(this.isEven=c(this,k)%2===(t?0:1),!this.isUncovered)this.isEven?c(this,H).texture=y.getTexture("gui/dark.png"):c(this,H).texture=y.getTexture("gui/light.png");else{if(this.isEven?c(this,H).texture=y.getTexture("gui/grey.png"):c(this,H).texture=y.getTexture("gui/white.png"),!c(this,B))debugger;c(this,bt)||(b(this,bt,!0),this.scene.emitter.updateSpawnPos(this.x+this.width/2,this.y+this.height/2),this.scene.emitter.emitNow()),c(this,_).visible=c(this,B).isMine||c(this,B).adjacentMines>0,c(this,B).isMine&&!c(this,G).visible?(c(this,G).visible=!0,this.playChestOpenAnimation(),c(this,_).texture=y.getTexture("gui/5.png"),c(this,_).width=c(this,_).height=c(this,H).width*.3):c(this,B).adjacentMines>0&&(c(this,_).texture=y.getTexture("gui/"+c(this,B).adjacentMines+".png"),c(this,_).width=c(this,_).height=c(this,H).width*.4)}}onMouseClick(){if(!this.scene.mGrid.grid[c(this,I)][c(this,k)].isCovered||this.scene.mGrid.isGameWon()){this.scene.triggerMiss();return}let t=1;this.scene.mGrid.uncover(c(this,I),c(this,k)),c(this,B).isMine?(this.scene.explosion(this.x+this.width/2,this.y+this.height/2),t=5):t=this.scene.mGrid.grid[c(this,I)][c(this,k)].adjacentMines,this.scene.addScore(t),this.scene.updateBoard(),this.scene.mGrid.isGameWon()&&(this.scene.levelClearSprite.visible=!0,setTimeout(()=>{this.scene.levelClearSprite.visible=!1,this.scene.resetBoard(),this.scene.updateBoard()},3e3))}onMouseOver(){}onMouseOut(){}}k=new WeakMap,I=new WeakMap,H=new WeakMap,_=new WeakMap,B=new WeakMap,G=new WeakMap,bt=new WeakMap;class Fi extends K{constructor(){super(...arguments);a(this,"menuItem");a(this,"storeUnsub");a(this,"playersList");a(this,"missMenuBtn");a(this,"board");a(this,"boardContainer");a(this,"mGrid");a(this,"explosionAnimation");a(this,"levelClearSprite");a(this,"emitter");a(this,"particlesContainer")}setup(){const t=()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())};this.menuItem=dt(t),this._sceneContainer.addChild(this.menuItem),ut(this._sceneContainer),p().addTo(this._sceneContainer).call(nt),this.playersList=new it(this.store,Ot),p(this.playersList).pos(z,X).addTo(this._sceneContainer),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),this.missMenuBtn=pt(()=>{const e=this.store.getState(),{activePlayer:i}=e.activePlayer;this.store.dispatch(O(i,Ot))}),this.missMenuBtn.interactive=!0,this._sceneContainer.addChild(this.missMenuBtn),this.storeUnsub=this.store.subscribe(this.updateState.bind(this)),this.updateState(),this.mGrid=new Ne(rt,at,Le),this.createBoard(),this.addExplosionAnimation(),this.particlesContainer=new N,this.particlesContainer.name="particlesContainer",this.boardContainer.addChild(this.particlesContainer),this.emitter=Pi(this.particlesContainer),this.levelClearSprite=p().name("levelClear").pos(M/2,680).anc(.5,.5).sc(.85,.85).hide().addTo(this._sceneContainer).sp,Rs(this.levelClearSprite)}updateBoard(){for(let t=0;t<rt;t++)for(let e=0;e<at;e++){const i=this.board[t][e],n=this.mGrid.grid[t][e];i.isUncovered=!n.isCovered,i.updateGraphics()}}resetBoard(){this.mGrid=new Ne(rt,at,Le);for(let t=0;t<rt;t++)for(let e=0;e<at;e++){const i=this.board[t][e],n=this.mGrid.grid[t][e];n.isCovered=!0,i.isUncovered=!1,i.updateGraphics(),i.hideContnt()}}createBoard(){const t=at*E/2,e=rt*E/2;this.boardContainer=new N,this.boardContainer.position.set(313,515),this._sceneContainer.addChild(this.boardContainer),this.board=new Array(rt);for(let i=0;i<rt;i++){const n=new Array(at);for(let o=0;o<at;o++){const r=new Li(this);r.xColumn=o,r.yRow=i,r.visible=!0,p(r).size(E,E).pos(-t+E/2+o*E,120-e+E/2+i*E).addTo(this.boardContainer),n[o]=r}this.board[i]=n}}updateState(){const t=this.store.getState();this.playersList.updateState(t)}teardown(){}addScore(t){const e=this.store.getState(),{activePlayer:i}=e.activePlayer;this.store.dispatch(j(i,t,Ot))}triggerMiss(){const t=this.store.getState(),{activePlayer:e}=t.activePlayer;this.store.dispatch(O(e,Ot))}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.boardContainer).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}tick(){const t=Date.now(),e=(t-Fe)*.001;this.emitter.update(e),Fe=t}}const xt=m.FLATTTENED_TARGET_SCENE,Ni=[11,10,9,8,7],Ri=[1,2,3,4,5],Re=30;class wt{constructor(s,t){a(this,"radius");a(this,"centerY");this.radius=s,this.centerY=t}checkPoint(s,t){if(s>-this.radius&&s<this.radius&&t>-this.centerY&&t<this.centerY)return!0;let e=t- -this.centerY;return Math.sqrt(s*s+e*e)<this.radius||(e=t-this.centerY,Math.sqrt(s*s+e*e)<this.radius)}}let yt,Ut,ke,te,ee,U;class Ie extends x{constructor(t){super();a(this,"targetIndex");a(this,"isViolet");a(this,"isActive");this.anchor.set(.5,.5),this.texture=y.getTexture(t)}}class ki extends K{constructor(){super(...arguments);a(this,"playersPanel");a(this,"activeTarget");a(this,"playersList");a(this,"target");a(this,"explosionAnimation")}setup(){dt(()=>{this.switchSceneTo(m.MENU_SCENE),this.store.dispatch(st())},this._sceneContainer),te=pt(()=>{const n=this.store.getState(),{activePlayer:o}=n.activePlayer;this.store.dispatch(O(o,xt))}),te.interactive=!0,this._sceneContainer.addChild(te),ut(this._sceneContainer),yt=[],Ut=[],ee=0,U=[],this.target=p().addTo(this.centered).y(Re).sp;for(const n of Ri){const o="a_"+n,r=new Ie("main_a/"+o+".png");r.targetIndex=n,r.interactive=!0,yt.push(r),this.target.addChild(r)}U.push(new wt(238,95)),U.push(new wt(199,84)),U.push(new wt(139,55)),U.push(new wt(78,30)),U.push(new wt(50,20));const e=new x(y.getTexture("main_a/a_numbers.png"));e.anchor.set(.5,.5),this.target.addChild(e);const i=p("gui/white.png").alpha(0).size(700,700).sp;i.anchor.set(.5,.5),this.target.addChild(i),yt=yt.reverse(),U=U.reverse(),this.playersList=new it(this.store,xt),this.playersList.y=X,this.playersList.x=z,p(this.playersList).addTo(this._sceneContainer),this.playersList.onScoreTable.add(()=>{this.switchSceneTo(m.SCORE_SCENE)}),p().call(nt).addTo(this._sceneContainer),ke=this.store.subscribe(this.updateState.bind(this)),this.updateState(),setTimeout(this.subscribe.bind(this),500),this.addExplosionAnimation()}addVioletTarget(t,e){const i="violet_circle.png",n=new Ie("main/"+i);n.isViolet=!0,n.scale.set(.17,.17),n.position.set(t,e),n.interactive=!0,n.visible=!1,this.target.addChild(n);const o=new f("20",{fontName:"Desyrel",align:"center"});o.visible=!1,o.filters=[new oe({color:0,innerStrength:0,outerStrength:1})],o.position.set(n.position.x-o.width/2,n.position.y-o.height/2),this.target.addChild(o),n.on("mouseup",this.onVioletClick,this),Ut.push(n),Ut.push(o)}onVioletClick(){const t=this.store.getState(),{activePlayer:e}=t.activePlayer;P.play("boing"),this.store.dispatch(j(e,20,xt))}addExplosionAnimation(){const t=[];for(let i=0;i<59;i++){const n=y.getTexture(`explosion/boom3_${i}.png`);t.push(n)}const e=new ct(t);e.visible=!1,e.loop=!1,e.onComplete=()=>{e.stop(),e.visible=!1},p(e).addTo(this.app.stage).anc(.5,.5).scale(2).blending(et.ADD),this.explosionAnimation=e}explosion(t=0,e=0){this.explosionAnimation.x=t+5,this.explosionAnimation.y=e-5,this.explosionAnimation.visible=!0,this.explosionAnimation.gotoAndPlay(0)}subscribe(){this.centered.interactive=!0,this.centered.on("mousemove",this.onMouseMove,this),this.centered.on("mouseup",this.onMouseUp,this)}unsubscribe(){this.centered.interactive=!1,this.centered.removeAllListeners()}updateState(){const t=this.store.getState();this.playersList.updateState(t)}onMouseUp(t){const{x:e,y:i}=t.data.global,n=this.store.getState(),{activePlayer:o}=n.activePlayer;if(this.explosion(e,i),P.play("boing"),this.activeTarget>=0?this.store.dispatch(j(o,Ni[this.activeTarget],xt)):this.store.dispatch(O(o,xt)),ee++,ee>1)for(const r of Ut)r.visible=!0,r.interactive=!0,r.on("mouseup",this.onVioletClick,this)}onMouseMove(t){const{x:e,y:i}=this.centered.toLocal(t.data.global);let n=-1;for(let o=0;o<U.length;o++)if(U[o].checkPoint(e,i-Re)){n=o;break}for(let o=0;o<yt.length;o++){const r=yt[o],l=o===n;if(r.isActive!==l){const d=r.targetIndex;if(l){P.play("click1");const g="a_h_"+d;r.texture=y.getTexture("main_a/"+g+".png")}else{const g="a_"+d;r.texture=y.getTexture("main_a/"+g+".png")}}r.isActive=l}this.activeTarget=n}teardown(){this.app.stage.removeChild(this.explosionAnimation),ke(),this.unsubscribe()}tick(){}}let Dt,ft;const Z=document.getElementById("loader"),Ii=document.getElementById("version");Bi();async function Bi(){if(window.__TAURI__)try{let e=localStorage.getItem("axeHwId");e==null&&(e=V(0,1e5).toString(),localStorage.setItem("axeHwId",e)),Tt().setHwId(e).setIsDevelopersBuild(!1).send("launch-app")}catch{}Z.innerText="Loading 10%";const h=m.MENU_SCENE,s=ai();s.dispatch(ue()),Z.innerText="Loading 15%",await Fs(),Z.innerText="Loading 20%",await y.init(),Z.innerText="Loading 25%",Dt=new gs({antialias:!0,backgroundColor:0,resizeTo:window,resolution:2,autoDensity:!0}),globalThis.__PIXI_APP__=Dt,Gt.appendChild(Dt.view),Lt.from("Arial",{fill:"#333333",fontSize:60,fontWeight:"bold"}),Lt.from("sans-serif",{fill:"#333333",fontSize:40}),Lt.from("Desyrel",{fill:"#ffffff",fontSize:30,fontWeight:"900"}),Lt.from("Inter",{fill:"#ffffff",fontSize:33,fontWeight:"900"});const t=[{name:m.MENU_SCENE,sceneFactory:()=>new zs,gameScene:null},{name:m.LUCKY_SCENE,sceneFactory:()=>new Xs,gameScene:null},{name:m.MINI_TARGET_SCENE,sceneFactory:()=>new Os,gameScene:null},{name:m.TARGET_SCENE,sceneFactory:()=>new Gs,gameScene:null},{name:m.SURVIVAL_SCENE,sceneFactory:()=>new Js,gameScene:null},{name:m.SCORE_SCENE,sceneFactory:()=>new hi,gameScene:null},{name:m.MINESWEEPER_SCENE,sceneFactory:()=>new Fi,gameScene:null},{name:m.FLATTTENED_TARGET_SCENE,sceneFactory:()=>new ki,gameScene:null},{name:m.TOWER_SCENE,sceneFactory:()=>new js,gameScene:null}];if(ft=new Cs(Dt,s,t,h),Ae(ft.scenesContainer,!0),Z.innerText="Loading 30%",Object.assign(window,{sceneManager:ft,defaultScene:ft.activeScene,moveActivate:Ae,moveDeactivate:ri,PIXI:ys}),window.__TAURI__){const e=await fs(),i=new f(e,{fontName:"Desyrel"});i.x=M-60,ft.scenesContainer.addChild(i)}Z.innerText="Loading 40%",h!==m.MENU_SCENE&&h!=="menu_scene"&&s.dispatch(ie(h)),Z.innerText="Loading 99%",Z.remove(),Ii.remove(),requestAnimationFrame(ss)}function ss(h){requestAnimationFrame(ss),ft.update(h),T.update(h)}
